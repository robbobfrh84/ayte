<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <title>ayte</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
  <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
  <link rel="ayte icon" href="gfx/ayteFlower.png"/>
  <style>

    body {
      text-align: center;
      font-family: courier;
      -webkit-text-size-adjust: 100%;
      background-color: #ddd
    }

    .navbar-brand{
      font-size: 30px;
    }

    .navbar-default{
      font-size: 18px;
      background-color: cornflowerblue;
      border-color: cornflowerblue;
      border-radius: 0;
      margin: 0;
    }

    #font-color, #title{
      color: #333;
    }

    #font-color{
      font-size: 20px;
      margin-top: 10px;
      height: 50px;
    }

    .navbar-default .navbar-toggle {
      background-color: #ccc;
      border: none;
      box-shadow: inset 0px 0px 5px 2px rgba(0,0,0,0.2);
    }

    #ayteFrame {
      font-size: 0;
      text-align: center;
      padding-top: 15px;
      -webkit-text-size-adjust: 68%;
    }

    .ayte { display: inline-block; background-color: #444;
      box-shadow: inset 0px 0px 5px 2px rgba(0,0,0,0.2);
      font-size: 6px;
      width: 8em;
      height: 8em;
      margin: 0.4em;
      border-radius: 1.5em;
    }

    #paletteFrame {
      width: 33em;
      height: 8.625em;
      text-align: center;
      margin: auto;
      margin-top: 15px;
      border-radius: 1.5em;
      padding: 0.5em;
      padding-left: 1.4em;
      background-color: cornflowerblue;
      box-shadow: 0px 0px 1px 1px rgba(0,0,0,0.5);
      -webkit-text-size-adjust: 66%;
    }

    #swatchContainer{
      font-size: 0;
      float: left;
    }

    .swatch {
      display: inline-block;
      box-shadow: inset 0px 3px 2px 0px rgba(0,0,0,0.3);
      font-size: 4.5px;
      width: 12em;
      height: 8em;
    }

    #swt6,#swt7,#swt8{box-shadow: inset 0px 0px 2px 0px rgba(0,0,0,0.3);}
    #swt11,#swt12,#swt13{box-shadow: inset 0px -3px 2px 0px rgba(0,0,0,0.3);}
    #swt5 {box-shadow: inset 3px 0px 2px 0px rgba(0,0,0,0.3);}
    #swt9 {box-shadow: inset -3px 0px 2px 0px rgba(0,0,0,0.3);}
    #swt0 { border-top-left-radius: 2em; box-shadow: inset 3px 3px 2px 0px rgba(0,0,0,0.3);}
    #swt4 { border-top-right-radius: 2em; box-shadow: inset -3px 3px 2px 0px rgba(0,0,0,0.3);}
    #swt10 { border-bottom-left-radius: 2em; box-shadow: inset 3px -3px 2px 0px rgba(0,0,0,0.3);}
    #swt14 { border-bottom-right-radius: 2em; box-shadow: inset -3px -3px 2px 0px rgba(0,0,0,0.3);}

    .button1 {   display: inline-block;
      font-size: 26px;
      color: #111;
      background-color: rgba(15,15,15,0.1);
      width: 5em;
      height: 1.5em;
      margin: 0.3em;
      border-radius: 0.2em;
      transition: background-color .25s ease-in-out;
    }

    .button1:hover { background-color: rgba(15,15,15,0.3);
      transition: color .25s ease-in-out;
    }

    .fiftyPM {
      -webkit-text-size-adjust: 50%;
    }

    @media screen and (min-width: 768px) {
      #font-color{
        font-size: 15px;
        margin: 0;
        height: 50px;
      }
    }

  </style>
</head>
<body>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
          <span class="sr-only active" id="hamburger">Toggle navigation</span>
          <span class="icon-bar" id='linez' style='background-color: firebrick;'></span>
          <span class="icon-bar" id='linez'style='background-color: darkgoldenrod;'></span>
          <span class="icon-bar" id='linez'style='background-color: green;'></span>
        </button>
        <a class="navbar-brand" href="#" id='title'>Ayte-by8</a>
      </div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#" id="font-color" >{LOG IN} / {Sign UP}</a></li>
          <li><a href="#" id="font-color" >Gallery</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <div id='ayteFrame' ></div>
    <div id='paletteFrame' >
      <div id='swatchContainer'></div>
      <div id='liveBtn' class='button1' onmousedown='liveStatus()'>Off Air</div>
      <div id='saveBtn' class='button1'>Save</div>
    </div><br>
    <div id='allash' onclick="fill(ash)" class='button1'
      style='background-color: rgba(0,0,0,0.2); width: 8em;'>Clear All</div>
  <script src="http://cdn.pubnub.com/pubnub-3.7.15.min.js"></script>
  <script>

    var userName = 'robbobfrh84'
    var ayteRGB = {
                  user : userName,
                  ayte : [[],[],[],[],[],[],[],[]
                          ,[],[],[],[],[],[],[],[]
                          ,[],[],[],[],[],[],[],[]
                          ,[],[],[],[],[],[],[],[]
                          ,[],[],[],[],[],[],[],[]
                          ,[],[],[],[],[],[],[],[]
                          ,[],[],[],[],[],[],[],[]
                          ,[],[],[],[],[],[],[],[]]
                  };

    var ayteByte = "0000000000000000000000000000000000000000000000000000000000000000";

    var ash = 'rgb(68, 68, 68)';//darkgrey
    var egg = 'rgb(240,234,214)';//eggshell
    var cfb = 'rgb(102, 155, 235)';//cornflowerblue
    var gdr = 'rgb(214, 163, 48)';//goldenrod
    var grn = 'rgb(0, 128, 0)';//green
    var fbc = 'rgb(169, 53, 47)';//firebrick
    var slb = 'rgb(106, 90, 205)';//lightgrey
    var ogr = 'rgb(255, 69, 0)';//orangered
    var gry = 'rgb(180, 180, 180)';//grey
    var org = 'rgb(235, 120, 0)';//orange
    var ind = 'rgb(96, 58, 134)';//indigo
    var pru = 'rgb(160, 82, 45)';//sienna
    var pnk = 'rgb(245, 182, 193)';//pink
    var sgn = 'rgb(32, 178, 170)';//lightseagreen
    var ygr = 'rgb(154, 205, 50)';//lightseagreen
    var brush = cfb;
    var swatch = [ash,egg,cfb,gdr,grn
                 ,gry,fbc,slb,ogr,org
                 ,sgn,pru,pnk,ind,ygr];

    for (var i = 0; i < 64; i++){
      if (i % 8 === 0){ ayteFrame.innerHTML += '<br>';}
      var blk = document.createElement('div');
      blk.className = 'ayte'; blk.id = 'blk'+i;
      blk.setAttribute('onmousedown', 'mouseState(true, blk'+i+','+i+')');
      blk.setAttribute('onmousemove', 'draw(blk'+i+','+i+')');
      //blk.setAttribute('onmouseup', 'mouseState(false)');
      blk.setAttribute('ontouchstart','draw(blk'+i+','+i+')');
      ayteFrame.appendChild(blk);
    }
    var mouseDown = false;
    //var waitForMsg = false;
    document.body.setAttribute('onmousedown', 'mouseState(true)');
    document.body.setAttribute('onmouseup', 'mouseState(false)');

    function draw(bId, x){
      if(mouseDown){
        bId.style.backgroundColor = brush;
        if (live) { ayteRGB.ayte[x] = brush; publishRGB(ayteRGB); }
      }
    }

    function mouseState(state, bId, x){ // draw and mouseState should be together!!!
      if (state){
        mouseDown = true;
        if(bId){
          draw(bId, x)
          // bId.style.backgroundColor = brush;
        }
      } else {
        mouseDown = false;
      }
    }

    ayteFrame.addEventListener('touchmove', touchMove);
    function touchMove(e){
      var x = document.elementFromPoint(e.touches[0].pageX, e.touches[0].pageY);
      if( x.id[0]+x.id[1]+x.id[2] === 'blk') {
        // var i = 3;
        // var n = '';
        // while(x.id[i]){n+=x.id[i]; i++; }
        // draw(x, parseInt(n))
        x.style.backgroundColor = brush;
        //if (live) { ayteRGB[0][0][x] = brush; publishRGB(ayteRGB[0][0]);}
      }
    }

    // function touchStart(bId){
    //   bId.style.backgroundColor = brush;
    //   //if (live) { ayteRGB[0][0][x] = brush; publishRGB(ayteRGB[0][0]);}
    // }

    ayteFrame.addEventListener('touchmove', function (event) {
        event.preventDefault();
    }, false);

    for (var i = 0; i < 15; i++){
      if (i % 5 === 0){ swatchContainer.innerHTML += '<br>';}
      var swt = document.createElement('div');
      swt.className = 'swatch'; swt.id = 'swt'+i;
      swt.style.backgroundColor = swatch[i];
      swt.setAttribute('onmousedown', 'brushSwap('+i+')');
      swt.setAttribute('ontouchstart','brushSwap('+i+')');
      swatchContainer.appendChild(swt);
    }

    function brushSwap(newCol){
      brush = swatch[newCol];
      paletteFrame.style.backgroundColor = brush;
    }

    function fill(col){
      for (var i = 0; i < 64; i++){
        document.getElementById('blk'+i).style.backgroundColor = ash;
      }
    }
    var live = false;
    function liveStatus(){
      if (!live) { live = true;
        liveBtn.style.color = fbc;
        liveBtn.innerHTML = 'Live!';
        historyRGB(1);
      } else { live = false;
        liveBtn.style.color = '#111';
        liveBtn.innerHTML = 'Off Air';
      }
    }

//-----------------------------------------------------------------------------
//---------------------PUBNUB MESSAGE CENTER-----------------------------------
//-----------------------------------------------------------------------------
  var settings = {
    channel: '1a',
    publish_key: 'pub-c-926e03e9-2cbb-4a3d-b17a-2ee47ca078a5',
    subscribe_key: 'sub-c-b3fbc6fa-0bf5-11e6-a8fd-02ee2ddab7fe'
  };
  var pubnub = PUBNUB(settings);

  function historyRGB(amount) {
    pubnub.history({
      channel: settings.channel,
      callback: function(m) {
        ayteRGB = m[0][0];
        console.log('Last Ayte-by8 published', ayteRGB);
        updateAyte();
      },
      count : amount,
      reverse : false
    });
  }

  pubnub.subscribe({
    channel: settings.channel,
    callback: function(m) {
      ayteRGB = m;
      console.log('Saw new live Ayte-by8 was published', ayteRGB);
      updateAyte();
      waitForMsg = false;
    },
    error: function(err) {console.log(err);}
  });

  function publishRGB(data) {
    //waitForMsg = true;
    pubnub.publish({
      channel: settings.channel,
      message: data
    });
    console.log("Published new live Ayte-by8");
  }

  //publishRGB(ayteRGB);
  function updateAyte() {
    for (var i = 0; i < 64; i++){
      var bId = document.getElementById('blk'+i);
      bId.style.backgroundColor = ayteRGB.ayte[i];
    }
  }


    //DONE!!   12:30                  //-BEFORE WE WRITE OUR CODE HERE...
    //DONE!!      "                   //...Test mkr1000 with old 8x8 code and dirty pubnub publish. JUST MAKE IT WORK!
    //DONE!!      "                   //...We'll clean it up when we re-write the code. just need to see if there's problems with LEDS.
    //DONE!!    2:37                  // run! - - -
    //DONE!!    3:33                  //-create empty index array
    //DONE!!    4:20                  //-update live click(change to Live! in red)
    //DONE!!    4:20                  //fix mouseDown bool by removing it from individual blocks and ading it to ayteframe.
    //DONE!!    6:50                  //-create funtion to update to live 8! & check history for last Ayte-by8
    //DONE!!    7:12                  //-checks every 200ms....

    //fix mouseDown bool by removing it from individual blocks and ading it to ayteframe.
    //clean up combine draw calls

    //-creat *if(we're live?) function that auto updates pixel changes to change live-8...
      //...Create JSON object and publish channel "Ayte-by8".
    //-create NEW ARDUINO arrey(of our 15 colors) in a 64 byte arrey.....
      //....update and publish live arrey("")
    //-create save button. calls function that publishes to channel "Gallery" With ALERT...
      //...Alert pops up entry text to name ayte.
      //...publish with time stamp? Google pubnub for info...It'll all be saved! don't need to generate ids.
    // set up frame display with mkr set up.
    // clean code. you're done!

    //*BONUS*
    //Write ard code that runs your three animations every 5 minutes and checks for updats every 5 sec.
    //IF there's an update, show and start/restart clock for 5 min to go back to animations.
    //set sleep timer to 1 hour... after that you've got to hit restart.
    //on restart you FIRST check for last pubnub post, display in display 5 min function...

  </script>
</body>
</html>
